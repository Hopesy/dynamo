<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.49">
    <meta name="referrer" content="no-referrer" />
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="referrer" content="no-referrer"><link rel="icon" href="/images/favicon.png"><title>Revit API基础 | Dynamo Learn</title><meta name="description" content="welocome to Dynamo wiki by hopesy">
    <link rel="modulepreload" href="/assets/app.4258e646.js"><link rel="modulepreload" href="/assets/revitAPI.html.1be3d316.js"><link rel="modulepreload" href="/assets/revitAPI.html.4df208dd.js"><link rel="prefetch" href="/assets/index.html.c0a2200c.js"><link rel="prefetch" href="/assets/pythonLearn.html.13bd0a30.js"><link rel="prefetch" href="/assets/pythonScript.html.e64b74b6.js"><link rel="prefetch" href="/assets/setup.html.7c08892a.js"><link rel="prefetch" href="/assets/template.html.bfed4e25.js"><link rel="prefetch" href="/assets/备份.html.6eb130ae.js"><link rel="prefetch" href="/assets/about.html.89550f86.js"><link rel="prefetch" href="/assets/copy.html.2bd2d471.js"><link rel="prefetch" href="/assets/excel.html.19dda8c5.js"><link rel="prefetch" href="/assets/hide.html.779f5958.js"><link rel="prefetch" href="/assets/loading.html.204176c9.js"><link rel="prefetch" href="/assets/message.html.e092a5f2.js"><link rel="prefetch" href="/assets/mongo.html.af391559.js"><link rel="prefetch" href="/assets/weixin.html.f2b4983d.js"><link rel="prefetch" href="/assets/basic.html.e64cd685.js"><link rel="prefetch" href="/assets/node.html.db28897c.js"><link rel="prefetch" href="/assets/resource.html.0d1ed27e.js"><link rel="prefetch" href="/assets/tipes.html.d765d4b5.js"><link rel="prefetch" href="/assets/404.html.7d858b3d.js"><link rel="prefetch" href="/assets/index.html.8119cda2.js"><link rel="prefetch" href="/assets/pythonLearn.html.2ddf65cc.js"><link rel="prefetch" href="/assets/pythonScript.html.9dc3d540.js"><link rel="prefetch" href="/assets/setup.html.a10dd0b9.js"><link rel="prefetch" href="/assets/template.html.4d340369.js"><link rel="prefetch" href="/assets/备份.html.5c3c6351.js"><link rel="prefetch" href="/assets/about.html.dc60d049.js"><link rel="prefetch" href="/assets/copy.html.171eeed9.js"><link rel="prefetch" href="/assets/excel.html.6a82bef8.js"><link rel="prefetch" href="/assets/hide.html.48853c63.js"><link rel="prefetch" href="/assets/loading.html.a2b4f19e.js"><link rel="prefetch" href="/assets/message.html.ab80fe08.js"><link rel="prefetch" href="/assets/mongo.html.6d557594.js"><link rel="prefetch" href="/assets/weixin.html.c05c6cea.js"><link rel="prefetch" href="/assets/basic.html.48401cd1.js"><link rel="prefetch" href="/assets/node.html.7cba7156.js"><link rel="prefetch" href="/assets/resource.html.37b6a42c.js"><link rel="prefetch" href="/assets/tipes.html.7dfbd49d.js"><link rel="prefetch" href="/assets/404.html.aedf9105.js"><link rel="prefetch" href="/assets/404.0a805f2c.js"><link rel="prefetch" href="/assets/Layout.4d445a43.js">
    <link rel="stylesheet" href="/assets/style.f4d22aab.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">Dynamo Learn</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="基础"><span class="title">基础</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="基础"><span class="title">基础</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/start/basic.md" class="" aria-label="起步"><!--[--><!--]--> 起步 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/start/node.md" class="" aria-label="节点"><!--[--><!--]--> 节点 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/start/tipes.md" class="" aria-label="技巧"><!--[--><!--]--> 技巧 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/start/resource.md" class="" aria-label="资源"><!--[--><!--]--> 资源 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="进阶"><span class="title">进阶</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="进阶"><span class="title">进阶</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/advance/setup.md" class="" aria-label="环境搭建"><!--[--><!--]--> 环境搭建 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/advance/template.md" class="" aria-label="常用模板"><!--[--><!--]--> 常用模板 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/advance/revitApi.md" class="" aria-label="Revit Api"><!--[--><!--]--> Revit Api <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/advance/pythonLearn.md" class="" aria-label="Python 学习"><!--[--><!--]--> Python 学习 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/advance/pythonScript.md" class="" aria-label="Python Script"><!--[--><!--]--> Python Script <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/example/hide.md" class="" aria-label="案例"><!--[--><!--]--> 案例 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="联系"><span class="title">联系</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="联系"><span class="title">联系</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/hopesy" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://hopesy.cc" rel="noopener noreferrer" target="_blank" aria-label="blog"><!--[--><!--]--> blog <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://space.bilibili.com/34975025?spm_id_from=333.1007.0.0" rel="noopener noreferrer" target="_blank" aria-label="B站"><!--[--><!--]--> B站 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/weixin.md" class="" aria-label="联系方式"><!--[--><!--]--> 联系方式 <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="基础"><span class="title">基础</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="基础"><span class="title">基础</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/start/basic.md" class="" aria-label="起步"><!--[--><!--]--> 起步 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/start/node.md" class="" aria-label="节点"><!--[--><!--]--> 节点 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/start/tipes.md" class="" aria-label="技巧"><!--[--><!--]--> 技巧 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/start/resource.md" class="" aria-label="资源"><!--[--><!--]--> 资源 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="进阶"><span class="title">进阶</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="进阶"><span class="title">进阶</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/advance/setup.md" class="" aria-label="环境搭建"><!--[--><!--]--> 环境搭建 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/advance/template.md" class="" aria-label="常用模板"><!--[--><!--]--> 常用模板 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/advance/revitApi.md" class="" aria-label="Revit Api"><!--[--><!--]--> Revit Api <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/advance/pythonLearn.md" class="" aria-label="Python 学习"><!--[--><!--]--> Python 学习 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/advance/pythonScript.md" class="" aria-label="Python Script"><!--[--><!--]--> Python Script <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/example/hide.md" class="" aria-label="案例"><!--[--><!--]--> 案例 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="联系"><span class="title">联系</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="联系"><span class="title">联系</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/hopesy" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://hopesy.cc" rel="noopener noreferrer" target="_blank" aria-label="blog"><!--[--><!--]--> blog <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://space.bilibili.com/34975025?spm_id_from=333.1007.0.0" rel="noopener noreferrer" target="_blank" aria-label="B站"><!--[--><!--]--> B站 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/weixin.md" class="" aria-label="联系方式"><!--[--><!--]--> 联系方式 <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a aria-current="page" href="/advance/revitAPI.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="Revit API基础"><!--[--><!--]--> Revit API基础 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/advance/revitAPI.html#前言" class="router-link-active router-link-exact-active sidebar-item" aria-label="前言"><!--[--><!--]--> 前言 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/advance/revitAPI.html#_1-文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.文档"><!--[--><!--]--> 1.文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/advance/revitAPI.html#_2-单位转换" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.单位转换"><!--[--><!--]--> 2.单位转换 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/advance/revitAPI.html#_3-解封与封装" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.解封与封装"><!--[--><!--]--> 3.解封与封装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/advance/revitAPI.html#_4-元素归属" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.元素归属"><!--[--><!--]--> 4.元素归属 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/advance/revitAPI.html#_5-geometry之间的转换" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.Geometry之间的转换"><!--[--><!--]--> 5.Geometry之间的转换 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/advance/revitAPI.html#_6-收集器及过滤器" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.收集器及过滤器"><!--[--><!--]--> 6.收集器及过滤器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/advance/revitAPI.html#_7-事务" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.事务"><!--[--><!--]--> 7.事务 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/advance/revitAPI.html#_8-反馈对话框" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.反馈对话框"><!--[--><!--]--> 8.反馈对话框 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/advance/revitAPI.html#_9-构件增删改查" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.构件增删改查"><!--[--><!--]--> 9.构件增删改查 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/advance/revitAPI.html#_10-编辑族" class="router-link-active router-link-exact-active sidebar-item" aria-label="10.编辑族"><!--[--><!--]--> 10.编辑族 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="revit-api基础" tabindex="-1"><a class="header-anchor" href="#revit-api基础" aria-hidden="true">#</a> Revit API基础</h1><h3 id="前言" tabindex="-1"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> 前言</h3><blockquote><p>介绍了一些Revit的简单API,都是用Python语法写的。</p></blockquote><h3 id="_1-文档" tabindex="-1"><a class="header-anchor" href="#_1-文档" aria-hidden="true">#</a> 1.文档</h3><h4 id="_1-获取当前文档" tabindex="-1"><a class="header-anchor" href="#_1-获取当前文档" aria-hidden="true">#</a> 1.获取当前文档</h4><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>doc <span class="token operator">=</span> DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentDBDocument
uiapp <span class="token operator">=</span> DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentUIApplication
app <span class="token operator">=</span> uiapp<span class="token punctuation">.</span>Application
uidoc <span class="token operator">=</span> uiapp<span class="token punctuation">.</span>ActiveUIDocument
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-获取链接文档" tabindex="-1"><a class="header-anchor" href="#_2-获取链接文档" aria-hidden="true">#</a> 2.获取链接文档</h4><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>collector <span class="token operator">=</span> Autodesk<span class="token punctuation">.</span>Revit<span class="token punctuation">.</span>DB<span class="token punctuation">.</span>FilteredElementCollector<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
linkInstances <span class="token operator">=</span> collector<span class="token punctuation">.</span>OfClass<span class="token punctuation">(</span>Autodesk<span class="token punctuation">.</span>Revit<span class="token punctuation">.</span>DB<span class="token punctuation">.</span>RevitLinkInstance<span class="token punctuation">)</span>
linkDoc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> e <span class="token keyword">in</span> linkInstances<span class="token punctuation">:</span>
  linkDoc<span class="token punctuation">.</span>append<span class="token punctuation">(</span>e<span class="token punctuation">.</span>GetLinkDocument<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-单位转换" tabindex="-1"><a class="header-anchor" href="#_2-单位转换" aria-hidden="true">#</a> 2.单位转换</h3><blockquote><p>dynamo的几何默认是m或者mm,revit Api的几何默认是英尺，revit中几何英尺需要除以0.3048转为m。</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>metersToFeet <span class="token operator">=</span> <span class="token number">0.3048</span>
feetToMeters <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> metersToFeet <span class="token comment">#英尺转换为毫米</span>
<span class="token comment"># 使用API获取单位转换比例</span>
dynamoUnitsLength <span class="token operator">=</span> someDynamoLengthFunction<span class="token punctuation">(</span><span class="token punctuation">)</span>
revitUnitsAfterConvert <span class="token operator">=</span> dynamoUnitsLength <span class="token operator">*</span> metersToFeet
<span class="token comment"># 使用API获取单位转换比例</span>
revitUnitsLength <span class="token operator">=</span> someRevitLengthFunction<span class="token punctuation">(</span><span class="token punctuation">)</span>
dynamoUnitsLengthAfterConvert <span class="token operator">=</span> revitUnitsLength <span class="token operator">*</span> feetToMeters
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-解封与封装" tabindex="-1"><a class="header-anchor" href="#_3-解封与封装" aria-hidden="true">#</a> 3.解封与封装</h3><h4 id="_1-解封" tabindex="-1"><a class="header-anchor" href="#_1-解封" aria-hidden="true">#</a> 1.解封</h4><blockquote><p>所有经过封装的元素都继承自<code>Revit.Elements</code>命名空间中的<code>Revit.Elements.Element</code>类。这个类提供一个可以引用RevitAPI中底层元素的公共属性<code>InternalElement</code>。此外，Dynamo提供了一个方法<code>UnwrapElement(Element)</code>用来接受传递进来的元素。如果传递的不是元素，不会进行任何修改。 Dynamo会将我们选中的的Revit元素自动“封装”成Dynamo的元素，当我们使用Python脚本调用RevitAPI来操作Revit元素时，就必须将元素“解封”成Revit API的元素。“解封”用到的方法就是“UnwrapElement()”函数。</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 该节点的输入内容将存储为 IN 变量中的一个列表。</span>
windows <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">#将输入的Dynamo元素解封，用Dynamo节点获取的窗</span>
<span class="token comment"># 将代码放在该行下面</span>
walls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> window <span class="token keyword">in</span> windows<span class="token punctuation">:</span>
    w <span class="token operator">=</span> windows<span class="token punctuation">.</span>Host  <span class="token comment">#获取窗所在的墙体，此方法为RevitAPI方法</span>
    walls<span class="token punctuation">.</span>append<span class="token punctuation">(</span>w<span class="token punctuation">)</span>
<span class="token comment"># 将输出内容指定给 OUT 变量。</span>
OUT <span class="token operator">=</span> walls
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>我们如果在Python Script里面使用Dynamo提供的库来操作元素，就不需要进行解封</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 该节点的输入内容将存储为 IN 变量中的一个列表。</span>
windows <span class="token operator">=</span> IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>   <span class="token comment">#将输入的Dynamo元素直接输入</span>
<span class="token comment"># 将代码放在该行下面</span>
levels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> window <span class="token keyword">in</span> windows<span class="token punctuation">:</span>
    level <span class="token operator">=</span> windows<span class="token punctuation">.</span>GetParameterValueByName<span class="token punctuation">(</span><span class="token string">&#39;标高&#39;</span><span class="token punctuation">)</span>  <span class="token comment">#获取窗所在的标高，此方法为RevitNodes方法</span>
    levels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>level<span class="token punctuation">)</span>
<span class="token comment"># 将输出内容指定给 OUT 变量。</span>
OUT <span class="token operator">=</span> levels
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-封装" tabindex="-1"><a class="header-anchor" href="#_2-封装" aria-hidden="true">#</a> 2.封装</h4><blockquote><p>为了能够与Dynamo的节点进行交互，任何一个由Python脚本中RevitApi生成的元素(包括类型参数，familyinstance等等)都必须封装成<code>Revit.Elements.Element</code>中的类,可使用<code>ToDSType(Bool)</code>方法完成。.False 不是revit拥有的，只受Dynamo控制,True 是revit拥有的，不受Dynamo控制。</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> clr
<span class="token comment"># Import ToDSType(bool) extension method</span>
clr<span class="token punctuation">.</span>AddReference<span class="token punctuation">(</span><span class="token string">&quot;RevitNodes&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> Revit
clr<span class="token punctuation">.</span>ImportExtensions<span class="token punctuation">(</span>Revit<span class="token punctuation">.</span>Elements<span class="token punctuation">)</span>
po <span class="token operator">=</span> IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
fam <span class="token operator">=</span> FamilyInstance<span class="token punctuation">.</span>ByPoint<span class="token punctuation">(</span>po<span class="token punctuation">)</span> <span class="token comment">#使用Dynamo节点生成族实例</span>
OUT <span class="token operator">=</span> <span class="token punctuation">[</span>
    fam<span class="token punctuation">.</span>ToDSType<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">#使用此方法之后的元素可以由Dynamo节点操纵</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-元素归属" tabindex="-1"><a class="header-anchor" href="#_4-元素归属" aria-hidden="true">#</a> 4.元素归属</h3><blockquote><p>我们用RevitAPI创建的元素，需要区分其归属，以便于了解哪些元素是Dynamo控制的,“ToDSType(bool)”方法；当&quot;bool&quot;为&quot;False&quot;时，RevitAPI创建的元素归属Dynamo；当&quot;bool&quot;为&quot;True&quot;时，RevitAPI创建的元素归属Revit。</p></blockquote><ul><li>Dynamo控制的元素无论点击运行多少次，都是覆盖重新生成元素，不会保留上次创建元素<code>False</code></li><li>Revit控制的再次运行,会保留上次创建元素<code>True</code></li></ul><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment">#获取当前文档</span>
doc <span class="token operator">=</span> DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentDBDocument
<span class="token comment"># 该节点的输入内容将存储为 IN 变量中的一个列表。</span>
familyType <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 将代码放在该行下面</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>EnsureInTransaction<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
familyInstance <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment">#point = XYZ(0,0,0)</span>
<span class="token keyword">for</span> x inrange <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> UnitUtils<span class="token punctuation">.</span>ConvertToInternalUnits<span class="token punctuation">(</span>x<span class="token punctuation">,</span>DisplayUnitType<span class="token punctuation">.</span>DUT_MILLIMETERS<span class="token punctuation">)</span> <span class="token comment">#单位转换为mm</span>
    ele <span class="token operator">=</span> doc<span class="token punctuation">.</span>Create<span class="token punctuation">.</span>NewFamilyInstance<span class="token punctuation">(</span>XYZ<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>x<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>familyType<span class="token punctuation">,</span>Structure<span class="token punctuation">.</span>StructuralType<span class="token punctuation">.</span>NonStructural<span class="token punctuation">)</span> <span class="token comment">#通过ReivtAPI创建构件</span>
<span class="token comment">#familyInstance.append(ele.ToDSType(False))  #将创建的元素归属于Dynamo</span>
    familyInstance<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ele<span class="token punctuation">.</span>ToDSType<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#将创建的元素归属于Revit</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>TransactionTaskDone<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 将输出内容指定给 OUT 变量。</span>
OUT <span class="token operator">=</span> familyInstance
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-geometry之间的转换" tabindex="-1"><a class="header-anchor" href="#_5-geometry之间的转换" aria-hidden="true">#</a> 5.Geometry之间的转换</h3><p>Revit中的几何体(点，曲线，实体等)都是几何对象。由Dynamo节点生成的几何体并不是Revit中的几何对象。我们需要使用RevitAPI进行转换。Dynamo提供了<code>GeometryConversion</code>工具。</p><blockquote><p>导入<code>GeometryConversion</code>之后尽可以使用下面列举的方法了。</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> clr
clr<span class="token punctuation">.</span>AddReference<span class="token punctuation">(</span><span class="token string">&quot;RevitNodes&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> Revit
<span class="token comment"># Import ToProtoType, ToRevitType geometry conversion extension methods</span>
clr<span class="token punctuation">.</span>ImportExtensions<span class="token punctuation">(</span>Revit<span class="token punctuation">.</span>GeometryConversion<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Revit转Dynamo。XYZ、Point指的是具体的实例对象，转换完成后输出的对象才能被Dynamo的节点作为输入端使用。</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>XYZ<span class="token punctuation">.</span>ToPoint<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> Point
XYZ<span class="token punctuation">.</span>ToVector<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> Vector
Point<span class="token punctuation">.</span>ToProtoType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> Point
List<span class="token operator">&lt;</span>XYZ<span class="token operator">&gt;</span><span class="token punctuation">.</span>ToPoints<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> List<span class="token operator">&lt;</span>Point<span class="token operator">&gt;</span>
UV<span class="token punctuation">.</span>ToProtoType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> UV
Curve<span class="token punctuation">.</span>ToProtoType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> Curve
CurveArray<span class="token punctuation">.</span>ToProtoType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> PolyCurve
PolyLine<span class="token punctuation">.</span>ToProtoType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> PolyCurve
Plane<span class="token punctuation">.</span>ToPlane<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> Plane
Solid<span class="token punctuation">.</span>ToProtoType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> Solid
Mesh<span class="token punctuation">.</span>ToProtoType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> Mesh
IEnumerable<span class="token operator">&lt;</span>Mesh<span class="token operator">&gt;</span><span class="token punctuation">.</span>ToProtoType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> Mesh<span class="token punctuation">[</span><span class="token punctuation">]</span>
Face<span class="token punctuation">.</span>ToProtoType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> IEnumerable<span class="token operator">&lt;</span>Surface<span class="token operator">&gt;</span>
Transform<span class="token punctuation">.</span>ToCoordinateSystem<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> CoordinateSystem
BoundingBoxXYZ<span class="token punctuation">.</span>ToProtoType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> BoundingBox
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Dynamo转Revit。XYZ、Point指的是具体的实例对象。由Dynamo节点创建的几何体（包括在Python Script中直接调用Dynamo节点创建的对象）转换完成后才能作为Python Script中Revit Api函数的输入参数</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>Point<span class="token punctuation">.</span>ToRevitType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> XYZ
Vector<span class="token punctuation">.</span>ToRevitType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> XYZ
Plane<span class="token punctuation">.</span>ToPlane<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> Plane
List<span class="token operator">&lt;</span>Point<span class="token operator">&gt;</span><span class="token punctuation">.</span>ToXyzs<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> List<span class="token operator">&lt;</span>XYZ<span class="token operator">&gt;</span>
Curve<span class="token punctuation">.</span>ToRevitType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> Curve
PolyCurve<span class="token punctuation">.</span>ToRevitType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> CurveLoop
Surface<span class="token punctuation">.</span>ToRevitType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> IList<span class="token operator">&lt;</span>GeometryObject<span class="token operator">&gt;</span>
Solid<span class="token punctuation">.</span>ToRevitType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> IList<span class="token operator">&lt;</span>GeometryObject<span class="token operator">&gt;</span>
Mesh<span class="token punctuation">.</span>ToRevitType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> IList<span class="token operator">&lt;</span>GeometryObject<span class="token operator">&gt;</span>
CoordinateSystem<span class="token punctuation">.</span>ToTransform<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> Transform
CoordinateSystem<span class="token punctuation">.</span>ToRevitBoundingBox<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> BoundingBoxXYZ
BoundingBox<span class="token punctuation">.</span>ToRevitType<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> BoundingBoxXYZ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-收集器及过滤器" tabindex="-1"><a class="header-anchor" href="#_6-收集器及过滤器" aria-hidden="true">#</a> 6.收集器及过滤器</h3><h4 id="_1-收集器-鱼池" tabindex="-1"><a class="header-anchor" href="#_1-收集器-鱼池" aria-hidden="true">#</a> 1.收集器（鱼池）</h4><blockquote><p>通过收集器，可以直接过滤出一些单类别的元素，例如系统族如墙、楼板、管道等都有固定的类型名称。根据类型名称（Wall，Floor，Pipe）可直接用“ofClass”收集。</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>collector <span class="token operator">=</span> FilteredElementCollector<span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">.</span>OfClass<span class="token punctuation">(</span>Wall<span class="token punctuation">)</span>
OUT <span class="token operator">=</span> collector<span class="token punctuation">.</span>ToElements<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>同样一些例如可载入族门，窗，家具，停车位等不像系统族一样有特定的类型名称，可以通过其族类别名称“BuiltInCategory”进行收集，当然系统族此方法也适用，如下代码示例：</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment">##系统族墙</span>
collector <span class="token operator">=</span> FilteredElementCollector<span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">.</span>OfCategory<span class="token punctuation">(</span>BuiltInCategory<span class="token punctuation">.</span>OST_Walls<span class="token punctuation">)</span>
OUT <span class="token operator">=</span> collector<span class="token punctuation">.</span>ToElements<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">##非系统族门（包含未放置的门）</span>
collector <span class="token operator">=</span> FilteredElementCollector<span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">.</span>OfCategory<span class="token punctuation">(</span>BuiltInCategory<span class="token punctuation">.</span>OST_Doors<span class="token punctuation">)</span>
OUT <span class="token operator">=</span> collector<span class="token punctuation">.</span>ToElements<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>但上述过滤出来的元素并非只是放置的族实例，还包含了未放置的族；为了只过滤出我们项目中放置了的族实例，可以采用“WhereElementIsNotElementType() ”方法收集。</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>collector <span class="token operator">=</span> FilteredElementCollector<span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">.</span>OfCategory<span class="token punctuation">(</span>BuiltInCategory<span class="token punctuation">.</span>OST_Walls<span class="token punctuation">)</span><span class="token punctuation">.</span>WhereElementIsNotElementType<span class="token punctuation">(</span><span class="token punctuation">)</span>
OUT <span class="token operator">=</span> collector<span class="token punctuation">.</span>ToElements<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-收集器-渔网" tabindex="-1"><a class="header-anchor" href="#_2-收集器-渔网" aria-hidden="true">#</a> 2.收集器（渔网）</h4><blockquote><p>过滤器的使用要配合收集器使用，打个比喻：收集器是池子，过滤器是网子，你想要网什么类型的鱼，必须得在在这个池子的基础上配合不同的网子来捕鱼。通过过滤器我们可以更自由的得到我们需要的元素。</p></blockquote><ul><li>快速过滤器：不在内存中展开元素细节，筛选速度较快。常用的方法有以下两种：<strong>“ElementCategoryFilter”“ElementClassFilter”；</strong></li><li>慢速过滤器：来筛选一些比较特殊的元素，例如房间空间等 ，例如：<strong>“RoomFilter”，“SpaceFilter”</strong>；同时还能找到与特定元素相交的元素，例如：“ElementIntersectsSolidFilter”，<strong>“ElementIntersectsElementFilter”。</strong></li><li>逻辑过滤器“LogicalOrFilter”（满足任一个条件），“LogicalAndFilter”（同时满足两个条件）。</li></ul><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>doc <span class="token operator">=</span> DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentDBDocument
collector <span class="token operator">=</span> FilteredElementCollector<span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token comment">#创建收集器(鱼池)</span>
wallfilter <span class="token operator">=</span> ElementClassFilter<span class="token punctuation">(</span>Wall<span class="token punctuation">)</span> <span class="token comment">#创建墙(系统族)的过滤器</span>
floorfilter <span class="token operator">=</span> ElementCategoryFilter<span class="token punctuation">(</span>BuiltInCategory<span class="token punctuation">.</span>OST_Doors<span class="token punctuation">)</span> <span class="token comment">#创建门(载入族)的过滤器</span>
andfilter <span class="token operator">=</span> LogicalOrFilter<span class="token punctuation">(</span>wallfilter<span class="token punctuation">,</span>floorfilter<span class="token punctuation">)</span> <span class="token comment">#将项目中所有门和墙都过滤出来</span>
OUT <span class="token operator">=</span> collector<span class="token punctuation">.</span>WherePasses<span class="token punctuation">(</span>andfilter<span class="token punctuation">)</span><span class="token punctuation">.</span>WhereElementIsNotElementType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ToElements<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#输出项目中的墙和门族实例</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-族、族类别、族实例获取" tabindex="-1"><a class="header-anchor" href="#_3-族、族类别、族实例获取" aria-hidden="true">#</a> 3.族、族类别、族实例获取</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/12420419/1650248774389-b4491935-2a46-4feb-aedf-997553770586.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=XcSNq&amp;originHeight=187&amp;originWidth=797&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p><blockquote><p>族类别、族、族类型和族实例也可以相互获取</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>familysymbol<span class="token operator">=</span>familyInstance<span class="token punctuation">.</span>Symbol<span class="token punctuation">;</span>
family<span class="token operator">=</span>familysymbol<span class="token punctuation">.</span>Family<span class="token punctuation">;</span>
familyInstanceS <span class="token operator">=</span> Family<span class="token punctuation">.</span>Instance<span class="token punctuation">;</span>
familySymbols <span class="token operator">=</span> Family<span class="token punctuation">.</span>FamilySymbol<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-事务" tabindex="-1"><a class="header-anchor" href="#_7-事务" aria-hidden="true">#</a> 7.事务</h3><blockquote><p>Revit是一个巨大的数据库程序。对该数据库的更改需要仔细排序，需要管理和检查流程(针对模式的有效性和针对Revit API的设计的合法性)。所有这些都是由Revit的本地Transaction API处理的。</p></blockquote><ul><li>早期的Revit API中TransactionMode有三个枚举值：Automatic、Manual和ReadOnly。</li><li>最新几个版本(2018以上)的Revit中只有两个枚举值：Manual和ReadOnly。</li><li>我们一般使用TransactionMode.Manual模式。</li></ul><p><code>①TransactionMode.Automatic:</code> Revit会在调用外部命令之前自动创建一个Transaction,并且该Transaction会在外面命令结朿时提交或者回滚。如果外部命令执行成功，则提交Transaction；如果有异常，则回滚。在该模式下，外部命令不能再创建自己的Transaction,但是可以创建 SubTransactions。 <code>②TransactionMode.Manual:</code> 此模式表示Revit不会自动创建一个Transaction。如果用户需要修改Revit摸型，则需要自行创建Transaction，并且自行管理这个Transaction提交还是回滚。 <code>③TransactionMode.ReadOnly：</code> 在该模式下，外部命令不能有任何的Transaction，否则在创建Transaction或者修改 Revit文档都会抛出异常。</p><blockquote><p>Dynamo提供了自己的事务框架，所以可以调用Dynamo中的TransactionManager类使用RevitAPI中的事务</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> clr
<span class="token comment"># Import DocumentManager and TransactionManager</span>
clr<span class="token punctuation">.</span>AddReference<span class="token punctuation">(</span><span class="token string">&quot;RevitServices&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> RevitServices
<span class="token keyword">from</span> RevitServices<span class="token punctuation">.</span>Persistence <span class="token keyword">import</span> DocumentManager
<span class="token keyword">from</span> RevitServices<span class="token punctuation">.</span>Transactions <span class="token keyword">import</span> TransactionManager
<span class="token comment"># Get the document</span>
doc <span class="token operator">=</span> DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentDBDocument
<span class="token comment"># 开启事务</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>EnsureInTransaction<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
<span class="token comment"># Create a reference point (requires a transaction)</span>
refPt <span class="token operator">=</span> doc<span class="token punctuation">.</span>FamilyCreate<span class="token punctuation">.</span>NewReferencePoint<span class="token punctuation">(</span>XYZ<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 提交事务</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>TransactionTaskDone<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意：</strong> 任何影响Revit文档数据库的代码都需要开启事务(建、修改、删除Revit模型或者更改颜色，替换过滤器材质等)简而言之，无论如何编辑Revit文档都需要打开一个Transaction。</p><h3 id="_8-反馈对话框" tabindex="-1"><a class="header-anchor" href="#_8-反馈对话框" aria-hidden="true">#</a> 8.反馈对话框</h3><blockquote><p>有时候我们需要弹出一些对话框来显示我们制定的内容，可以用“<strong>TaskDialogs</strong>”来实现</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2022/png/12420419/1650248774470-9886e419-620e-4b2f-98b3-57efaf880cf3.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=qIYgh&amp;originHeight=136&amp;originWidth=352&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>clr<span class="token punctuation">.</span>AddReference<span class="token punctuation">(</span><span class="token string">&quot;RevitAPIUI&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> Autodesk
<span class="token keyword">from</span> Autodesk<span class="token punctuation">.</span>Revit<span class="token punctuation">.</span>UI <span class="token keyword">import</span> <span class="token operator">*</span>
TaskDialog<span class="token punctuation">.</span>Show<span class="token punctuation">(</span><span class="token string">&quot;测试&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;测试&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://cdn.nlark.com/yuque/0/2022/png/12420419/1650248774548-11f402f6-ba7b-4a4b-87f3-3521d98254d1.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=Wq87G&amp;originHeight=212&amp;originWidth=549&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>task_dialog <span class="token operator">=</span> TaskDialog<span class="token punctuation">(</span><span class="token string">&quot;标题样例&quot;</span><span class="token punctuation">)</span>
task_dialog<span class="token punctuation">.</span>CommonButtons <span class="token operator">=</span> TaskDialogCommonButtons<span class="token punctuation">.</span>Cancel<span class="token operator">|</span> TaskDialogCommonButtons<span class="token punctuation">.</span>Ok<span class="token operator">|</span>TaskDialogCommonButtons<span class="token punctuation">.</span>Close<span class="token operator">|</span>TaskDialogCommonButtons<span class="token punctuation">.</span>Yes<span class="token operator">|</span>TaskDialogCommonButtons<span class="token punctuation">.</span>No<span class="token operator">|</span>TaskDialogCommonButtons<span class="token punctuation">.</span>Retry<span class="token operator">|</span>TaskDialogCommonButtons<span class="token punctuation">.</span><span class="token boolean">None</span>
task_dialog<span class="token punctuation">.</span>FooterText <span class="token operator">=</span> <span class="token string">&quot;脚部样例标题&quot;</span>
task_dialog<span class="token punctuation">.</span>MainInstruction <span class="token operator">=</span> <span class="token string">&quot;主窗口内容样例&quot;</span>
task_dialog<span class="token punctuation">.</span>MainContent <span class="token operator">=</span> <span class="token string">&quot;这是主要内容提示样例&quot;</span>
task_dialog<span class="token punctuation">.</span>Show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://www.yuque.com/attachments/yuque/0/2022/dyn/12420419/1650248774620-252174a4-aa83-4646-9f30-69e44723d29b.dyn" target="_blank" rel="noopener noreferrer">TaskDialog.dyn<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="_9-构件增删改查" tabindex="-1"><a class="header-anchor" href="#_9-构件增删改查" aria-hidden="true">#</a> 9.构件增删改查</h3><h4 id="_1-创建构件" tabindex="-1"><a class="header-anchor" href="#_1-创建构件" aria-hidden="true">#</a> 1.创建构件</h4><blockquote><p>各种构件的创建方法大同小异，翻翻API</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2022/png/12420419/1650248774710-e0440df7-52ec-444b-a5f2-ecda8b8288e7.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=F3pvy&amp;originHeight=282&amp;originWidth=829&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""><img src="https://cdn.nlark.com/yuque/0/2022/png/12420419/1650248774838-233f2f92-25dc-4e97-b57d-e4d71fa67dff.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=qF8K8&amp;originHeight=478&amp;originWidth=875&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment">#加载 Python Standard 和 DesignScript 库</span>
<span class="token keyword">import</span> clr
clr<span class="token punctuation">.</span>AddReference<span class="token punctuation">(</span><span class="token string">&#39;ProtoGeometry&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> Autodesk<span class="token punctuation">.</span>DesignScript<span class="token punctuation">.</span>Geometry <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment">#导入Revit模块</span>
clr<span class="token punctuation">.</span>AddReference<span class="token punctuation">(</span><span class="token string">&quot;RevitNodes&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> Revit
clr<span class="token punctuation">.</span>ImportExtensions<span class="token punctuation">(</span>Revit<span class="token punctuation">.</span>Elements<span class="token punctuation">)</span>
clr<span class="token punctuation">.</span>ImportExtensions<span class="token punctuation">(</span>Revit<span class="token punctuation">.</span>GeometryConversion<span class="token punctuation">)</span> <span class="token comment">#对Dynamo Geometry和Revit Element进行转换</span>
<span class="token comment">#导入 Document and transactions模块</span>
clr<span class="token punctuation">.</span>AddReference<span class="token punctuation">(</span><span class="token string">&quot;RevitServices&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> RevitServices
<span class="token keyword">from</span> RevitServices<span class="token punctuation">.</span>Persistence <span class="token keyword">import</span> DocumentManager
<span class="token keyword">from</span> RevitServices<span class="token punctuation">.</span>Transactions <span class="token keyword">import</span> TransactionManager
<span class="token comment">#导入 Revit API</span>
clr<span class="token punctuation">.</span>AddReference<span class="token punctuation">(</span><span class="token string">&#39;RevitAPI&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> Autodesk<span class="token punctuation">.</span>Revit<span class="token punctuation">.</span>DB <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> System
doc <span class="token operator">=</span> DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentDBDocument
lev <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">#输入标高并解封</span>
crv <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">#输入曲线并解封</span>
walls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>EnsureInTransaction<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> crv<span class="token punctuation">:</span>
    wall <span class="token operator">=</span> Wall<span class="token punctuation">.</span>Create<span class="token punctuation">(</span>doc<span class="token punctuation">,</span>c<span class="token punctuation">.</span>ToRevitType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lev<span class="token punctuation">.</span>Id<span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token comment">#注意将输入的Dynamo曲线转换为Revit曲线</span>
    <span class="token comment">#当输入为一条曲线的时候这样写会有点问题</span>
    walls<span class="token punctuation">.</span>append<span class="token punctuation">(</span>wall<span class="token punctuation">)</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>TransactionTaskDone<span class="token punctuation">(</span><span class="token punctuation">)</span>
OUT <span class="token operator">=</span> walls
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://secure2.wostatic.cn/static/a6Q8dYjHrbQHKkV2XbenSJ/Dyanmo%E5%88%9B%E5%BB%BA%E5%A2%99%EF%BC%88%E7%AE%80%E5%8D%95%EF%BC%89.dyn?auth_key=1660556546-jDAyYks8NGonFWz3V2ho5X-0-fdd23198d205bc470d8b73c2f836c7e0&amp;download=Dyanmo%E5%88%9B%E5%BB%BA%E5%A2%99%EF%BC%88%E7%AE%80%E5%8D%95%EF%BC%89.dyn" target="_blank" rel="noopener noreferrer">Dyanmo创建墙（简单）.dyn<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="_2-删除构件" tabindex="-1"><a class="header-anchor" href="#_2-删除构件" aria-hidden="true">#</a> 2.删除构件</h4><blockquote><p>删除构件，直接Delete</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2022/png/12420419/1650248774944-3549029b-11bc-47c2-984d-ee4672d417e3.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=gd2mk&amp;originHeight=88&amp;originWidth=1001&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>doc = DocumentManager.Instance.CurrentDBDocument
ele = UnwrapElement(IN[0])
TransactionManager.Instance.EnsureInTransaction(doc)
for e in ele:
    doc.Delete(e.Id)
TransactionManager.Instance.TransactionTaskDone()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-查询属性" tabindex="-1"><a class="header-anchor" href="#_3-查询属性" aria-hidden="true">#</a> 3.查询属性</h4><blockquote><p>查询文档中实例的属性，一般采用“get_Parameter(BuiltInParameter)”来查询获取实例的各内置参数的属性值。使用该方法时，需配合LookUp工具来确定该实例的“<strong>BuiltInParameter</strong>”。</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>doc <span class="token operator">=</span> DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentDBDocument
uiapp <span class="token operator">=</span> DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentUIApplication
app <span class="token operator">=</span> uiapp<span class="token punctuation">.</span>Application
uidoc <span class="token operator">=</span> DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentUIApplication<span class="token punctuation">.</span>ActiveUIDocument
col <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#需解封后再用RevitAPI操作</span>
levs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
lev <span class="token operator">=</span> col<span class="token punctuation">.</span>get_Parameter<span class="token punctuation">(</span>BuiltInParameter<span class="token punctuation">.</span>STAIRS_BASE_LEVEL_PARAM<span class="token punctuation">)</span><span class="token punctuation">.</span>AsValueString<span class="token punctuation">(</span><span class="token punctuation">)</span>
levs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>lev<span class="token punctuation">)</span>
OUT <span class="token operator">=</span> levs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>但并不是所有的参数都有其对应的“BuiltInParameter”，例如我们自己添加的项目参数，这时我们就可以用<strong>dynamo自带的“GetParameterValueByName(参数项名称)</strong>”或“**Revit APi中的LookupParameter(参数项名称)”**进行获取即可。 LookupParameter（）可以查询任何参数，项目参数，类型参数，实例参数。需要注意AsString（）、AsValueString（）的区别。当然获取类型参数，输入端是类型。</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment">### LookupParameter()查询实例参数</span>
col <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#需解封后再用RevitAPI操作</span>
pa <span class="token operator">=</span> col<span class="token punctuation">.</span>LookupParameter<span class="token punctuation">(</span><span class="token string">&quot;项目参数测试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>AsString<span class="token punctuation">(</span><span class="token punctuation">)</span>
pas<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pa<span class="token punctuation">)</span>
OUT <span class="token operator">=</span> pas
<span class="token comment">### GetParameterValueByName()查询实例参数</span>
col <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#需解封后再用RevitAPI操作</span>
pa <span class="token operator">=</span> col<span class="token punctuation">.</span>GetParameterValueByName<span class="token punctuation">(</span><span class="token string">&quot;项目参数测试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>AsString<span class="token punctuation">(</span><span class="token punctuation">)</span>
pas<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pa<span class="token punctuation">)</span>
OUT <span class="token operator">=</span> pas
<span class="token comment">### LookupParameter()查询系统族类型参数，例如墙</span>
pas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
col <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#需解封后再用RevitAPI操作，输入为选择的墙</span>
paName <span class="token operator">=</span> IN<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
ty <span class="token operator">=</span> col<span class="token punctuation">.</span>WallType
pa <span class="token operator">=</span> ty<span class="token punctuation">.</span>LookupParameter<span class="token punctuation">(</span>paName<span class="token punctuation">)</span><span class="token punctuation">.</span>AsValueString<span class="token punctuation">(</span><span class="token punctuation">)</span>
pas<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pa<span class="token punctuation">)</span>
OUT <span class="token operator">=</span> pas
<span class="token comment">### LookupParameter()查询可载入族类型参数</span>
pas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
col <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#需解封后再用RevitAPI操作，输入为选择的族</span>
paName <span class="token operator">=</span> IN<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
ty <span class="token operator">=</span> col<span class="token punctuation">.</span>Symbol
pa <span class="token operator">=</span> ty<span class="token punctuation">.</span>LookupParameter<span class="token punctuation">(</span>paName<span class="token punctuation">)</span><span class="token punctuation">.</span>AsValueString<span class="token punctuation">(</span><span class="token punctuation">)</span>
pas<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pa<span class="token punctuation">)</span>
OUT <span class="token operator">=</span> pas
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-修改属性" tabindex="-1"><a class="header-anchor" href="#_4-修改属性" aria-hidden="true">#</a> 4.修改属性</h4><blockquote><p>查询到属性后，后面加个set方法，实例类型都一样。注意需要开启事务</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment">## 修改可载入族的类型参数</span>
col <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#需解封后再用RevitAPI操作</span>
paName <span class="token operator">=</span> IN<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
paValue <span class="token operator">=</span> IN<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">0.3048</span><span class="token operator">/</span><span class="token number">100</span>
ty <span class="token operator">=</span> col<span class="token punctuation">.</span>Symbol
<span class="token comment">#执行事务,触发修改一切东西都要开启事务</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>EnsureInTransaction<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
pa <span class="token operator">=</span> ty<span class="token punctuation">.</span>LookupParameter<span class="token punctuation">(</span>paName<span class="token punctuation">)</span><span class="token punctuation">.</span>Set<span class="token punctuation">(</span>paValue<span class="token punctuation">)</span>
OUT <span class="token operator">=</span> pa
<span class="token comment">##修改实例参数</span>
col <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#需解封后再用RevitAPI操作</span>
paName <span class="token operator">=</span> IN<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
paVal <span class="token operator">=</span> IN<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token comment">#执行事务,触发修改一切东西都要开启事务</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>EnsureInTransaction<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
pa <span class="token operator">=</span> col<span class="token punctuation">.</span>LookupParameter<span class="token punctuation">(</span>paName<span class="token punctuation">)</span><span class="token punctuation">.</span>Set<span class="token punctuation">(</span>paVal<span class="token punctuation">)</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>TransactionTaskDone<span class="token punctuation">(</span><span class="token punctuation">)</span>
OUT <span class="token operator">=</span> pa
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://secure2.wostatic.cn/static/3oha25Gp3kNdtnnfZBTfMJ/%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0.dyn?auth_key=1660556711-tcwnB9DyfRgtW84XwJD6sg-0-2c91f5b91c6bf14fa335dd0cc5f5fcda&amp;download=%E6%9F%A5%E8%AF%A2%E4%BF%AE%E6%94%B9%E5%8F%82%E6%95%B0.dyn" target="_blank" rel="noopener noreferrer">查询参数.dyn<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="_5-构件隔离隐藏" tabindex="-1"><a class="header-anchor" href="#_5-构件隔离隐藏" aria-hidden="true">#</a> 5.构件隔离隐藏</h4><blockquote><p>拿到需要隔离的图元或者类别ID即可，隐藏同理但需要注意数据类型把列表转化为泛型</p></blockquote><div class="language-Python ext-Python line-numbers-mode"><pre class="language-Python"><code>##隔离图元
elements = UnwrapElement(IN[0])
view = UnwrapElement(doc.ActiveView)
elementIds = List[ElementId]()
for e in elements:
    elementIds.Add(e.Id)
TransactionManager.Instance.EnsureInTransaction(doc)
view.IsolateElementsTemporary(elementIds)
TransactionManager.Instance.TransactionTaskDone()
OUT = elementIds
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment">##隐藏图元</span>
elements <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
view <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>ActiveView<span class="token punctuation">)</span>
elementIds <span class="token operator">=</span> List<span class="token punctuation">[</span>ElementId<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> e <span class="token keyword">in</span> elements<span class="token punctuation">:</span>
    elementIds<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>e<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
b <span class="token operator">=</span> List<span class="token punctuation">[</span>ElementId<span class="token punctuation">]</span><span class="token punctuation">(</span>elementIds<span class="token punctuation">)</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>EnsureInTransaction<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
view<span class="token punctuation">.</span>HideElements<span class="token punctuation">(</span>elementIds<span class="token punctuation">)</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>TransactionTaskDone<span class="token punctuation">(</span><span class="token punctuation">)</span>
OUT <span class="token operator">=</span> elementIds
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://secure2.wostatic.cn/static/9cen6cH5cg8iCCejwksjxg/%E6%9E%84%E4%BB%B6%E9%9A%94%E7%A6%BB%E9%9A%90%E8%97%8F.dyn?auth_key=1660556752-tAKtFvP7sLjYGV9SVeV8VL-0-da9ccb3b6d00869e8b2d97d08f232988&amp;download=%E6%9E%84%E4%BB%B6%E9%9A%94%E7%A6%BB%E9%9A%90%E8%97%8F.dyn" target="_blank" rel="noopener noreferrer">构件隔离隐藏.dyn<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="_6-复制移动旋转镜像" tabindex="-1"><a class="header-anchor" href="#_6-复制移动旋转镜像" aria-hidden="true">#</a> 6.复制移动旋转镜像</h4><blockquote><p>ElementTransformUtils下面很多静态方法</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2022/png/12420419/1650248775034-cfd407ee-a79c-4f1d-962e-9a1f623f28f9.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=Ywxlt&amp;originHeight=848&amp;originWidth=827&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""><img src="https://cdn.nlark.com/yuque/0/2022/png/12420419/1650248775183-ebd3528f-3d52-4023-ba85-c630cec85ec9.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=i4f5f&amp;originHeight=196&amp;originWidth=457&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p><blockquote><p>使用方法都大同小异</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment">###移动模型</span>
elements <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
location <span class="token operator">=</span> IN<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ToRevitType<span class="token punctuation">(</span><span class="token punctuation">)</span>
elementIds <span class="token operator">=</span> List<span class="token punctuation">[</span>ElementId<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> e <span class="token keyword">in</span> elements<span class="token punctuation">:</span>
    elementIds<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>e<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>EnsureInTransaction<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
ElementTransformUtils<span class="token punctuation">.</span>MoveElements<span class="token punctuation">(</span>doc<span class="token punctuation">,</span>elementIds<span class="token punctuation">,</span>location<span class="token punctuation">)</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>TransactionTaskDone<span class="token punctuation">(</span><span class="token punctuation">)</span>
OUT <span class="token operator">=</span> elementIds
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment">###复制模型</span>
elements <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
location <span class="token operator">=</span> IN<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ToRevitType<span class="token punctuation">(</span><span class="token punctuation">)</span>
elementIds <span class="token operator">=</span> List<span class="token punctuation">[</span>ElementId<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> e <span class="token keyword">in</span> elements<span class="token punctuation">:</span>
    elementIds<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>e<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>EnsureInTransaction<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
ElementTransformUtils<span class="token punctuation">.</span>CopyElements<span class="token punctuation">(</span>doc<span class="token punctuation">,</span>elementIds<span class="token punctuation">,</span>location<span class="token punctuation">)</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>TransactionTaskDone<span class="token punctuation">(</span><span class="token punctuation">)</span>
OUT <span class="token operator">=</span> elementIds
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment">###旋转模型</span>
elements <span class="token operator">=</span> UnwrapElement<span class="token punctuation">(</span>IN<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
axis <span class="token operator">=</span> IN<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ToRevitType<span class="token punctuation">(</span><span class="token punctuation">)</span>
angle <span class="token operator">=</span> IN<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
elementIds <span class="token operator">=</span> List<span class="token punctuation">[</span>ElementId<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> e <span class="token keyword">in</span> elements<span class="token punctuation">:</span>
    elementIds<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>e<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>EnsureInTransaction<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
ElementTransformUtils<span class="token punctuation">.</span>RotateElements<span class="token punctuation">(</span>doc<span class="token punctuation">,</span>elementIds<span class="token punctuation">,</span>axis<span class="token punctuation">,</span>angle<span class="token punctuation">)</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>TransactionTaskDone<span class="token punctuation">(</span><span class="token punctuation">)</span>
OUT <span class="token operator">=</span> elementIds
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://secure2.wostatic.cn/static/geC7xvGvBvwBdNYvNvMELk/%E5%A4%8D%E5%88%B6%E7%A7%BB%E5%8A%A8%E6%97%8B%E8%BD%AC%E9%95%9C%E5%83%8F.dyn?auth_key=1660556775-uTDyekYy7to8TTcT8MZgMv-0-49ffa074157d492595b7f01b1ef3cf92&amp;download=%E5%A4%8D%E5%88%B6%E7%A7%BB%E5%8A%A8%E6%97%8B%E8%BD%AC%E9%95%9C%E5%83%8F.dyn" target="_blank" rel="noopener noreferrer">复制移动旋转镜像.dyn<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="_10-编辑族" tabindex="-1"><a class="header-anchor" href="#_10-编辑族" aria-hidden="true">#</a> 10.编辑族</h3><blockquote><p>在Revit中各种类型的可载入族都是基于其对应的族样板创建出来的，用户可根据不同的项目应用需求，创建各种类型的族。</p></blockquote><p>在Revit API中，族文档也是Document，可通过 <code>Document.IsFamilyDocument</code>来判断Document是族文档还是项目文档。在项目文档中，如果需要编辑特定族，可通过<code>Document.EditFamily(family)</code>在后台打开族文件，编辑完后通过<code>Document.LoadFamily</code>加载回来。也可以通过样板文件直接创建族<code>Application.NewFamilyDocument(templateFileName)</code></p><blockquote><p>主要API</p></blockquote><ul><li>族类型和族参数的管理 <code>FamilyManager</code> 管理所有族类型相关的编辑行为 <code>FamilyType</code> 族类型 <code>FamilyParameter</code> 族参数</li><li>几何图元的管理 <code>FamilyItemFactory</code>族文件的创建类</li><li>几何图元的可见性管理 <code>FamilyElementVisibility</code> 编辑图元的可见性</li></ul><h4 id="_1-族类型" tabindex="-1"><a class="header-anchor" href="#_1-族类型" aria-hidden="true">#</a> 1.族类型</h4><blockquote><p>在族类型编辑器中，只有一个族类型是当前类型，族参数的修改只是针对当前类型。打开一个族文档或者族模板时，应当新建一个族类型，避免族类型为空保证API能正常使用。</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2022/png/12420419/1650248775305-d2ba59cd-1dba-4642-a84e-0736147d7e72.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=paTIt&amp;originHeight=557&amp;originWidth=1169&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p><blockquote><p>创建族类型需要使用 <code>familyManager.NewType(TypeName)</code>方法</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2022/png/12420419/1650248775471-9408f69c-78e2-4cda-9bbd-2989b154d70b.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=zp1EW&amp;originHeight=474&amp;originWidth=774&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment">#获取当前文档</span>
doc <span class="token operator">=</span> DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentDBDocument
<span class="token comment">#判断是否是族文档</span>
faType <span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>doc<span class="token punctuation">.</span>IsFamilyDocument<span class="token punctuation">)</span> ：
     <span class="token comment">#只有当前文档是族文档才能获取FamilyManager</span>
     FamilyManager faMgr <span class="token operator">=</span> doc<span class="token punctuation">.</span>FamilyManager
<span class="token comment">#获取当前族类型，可能为空</span>
curFatype <span class="token operator">=</span> faMgr<span class="token punctuation">.</span>CurrentType
<span class="token keyword">if</span> curFatype <span class="token punctuation">:</span>
   <span class="token comment">#如果为空新建一个族类型，也可以写成 if curFatype is None ；</span>
   faMgr<span class="token punctuation">.</span>NewType<span class="token punctuation">(</span><span class="token string">&quot;testName&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span> <span class="token punctuation">:</span>
    <span class="token comment">#不为空进行操作</span>
    faType <span class="token operator">=</span> curFatype
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>删除族类型。<code>FamilyManager.DeleteCurrentType()</code>。一般来说，函数把当前族类型删除后，会自动把第一个族类型设置为当前族类型，最后一个族类型是无法删除的。</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2022/png/12420419/1650248775569-aeadacb7-11fe-4629-9dfd-e4c72f6a1d24.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=JnaqC&amp;originHeight=796&amp;originWidth=922&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment">#获取当前文档</span>
doc <span class="token operator">=</span> DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentDBDocument
<span class="token comment">#判断是否是族文档</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>doc<span class="token punctuation">.</span>IsFamilyDocument<span class="token punctuation">)</span> ：
     <span class="token comment">#只有当前文档是族文档才能获取FamilyManager</span>
     FamilyManager faMgr <span class="token operator">=</span> doc<span class="token punctuation">.</span>FamilyManager
<span class="token comment">#获取当前族类型，可能为空</span>
curFatype <span class="token operator">=</span> faMgr<span class="token punctuation">.</span>CurrentType
<span class="token keyword">if</span> curFatype <span class="token operator">!=</span> <span class="token boolean">None</span> <span class="token punctuation">:</span>
    <span class="token comment">#不为空进行操作。删除当前族类型</span>
    <span class="token comment">#为了确保安全。还是最好显式的设置为自己需要的类型</span>
    faMgr<span class="token punctuation">.</span>DeleteCurrentType<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>faMgr<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>Size <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>
        temp <span class="token operator">=</span> faMgr<span class="token punctuation">.</span>Types<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">#包含了所有FamilyTpe的合集，语法方面还要测试一下</span>
        faMgr<span class="token punctuation">.</span>CurrentType <span class="token operator">=</span> temp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>重命名族类型。<code>FamilyManager.RenameCurrentType()</code></p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2022/png/12420419/1650248775732-f5db3da8-701f-4591-bc6f-a7368f692b37.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=zlOXg&amp;originHeight=200&amp;originWidth=835&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment">#获取当前文档</span>
doc <span class="token operator">=</span> DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentDBDocument
<span class="token comment">#判断是否是族文档</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>doc<span class="token punctuation">.</span>IsFamilyDocument<span class="token punctuation">)</span> ：
     <span class="token comment">#只有当前文档是族文档才能获取FamilyManager</span>
     FamilyManager faMgr <span class="token operator">=</span> doc<span class="token punctuation">.</span>FamilyManager
<span class="token comment">#族类型的名字，要保证唯一性</span>
faMgr<span class="token punctuation">.</span>RenameCurrentType<span class="token punctuation">(</span><span class="token string">&quot;uniqueName&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-创建几何图元" tabindex="-1"><a class="header-anchor" href="#_2-创建几何图元" aria-hidden="true">#</a> 2.创建几何图元</h4><blockquote><p>Revit支持实体（实心）几何图元和剪切体（空心）几何图元的创建，并通过几何图元的组合创建复杂的几何体。共有五种创建方法，<code>拉伸、融合、旋转、放样、放样融合</code>。</p></blockquote><p>这几个方法都在定义在<code>Autodesk.Creation.FamilyItemFactory</code>类中，我们可以通过<code>doc.FamilyCreate</code>属性取得<code>FamilyItemFactory</code>类的实例。（点击表格右侧链接查看详细用法）</p><p>| `Extrusion NewExtrusion(bool isSolid,CurveArrArray profile,</p><table><thead><tr><th>SketchPlane sketchPlane,double end)`</th><th><a href="https:_apidocs.co_apps_revit_2020_425e8577-ba2a-ba19-ac24-069078f97209">拉伸</a></th></tr></thead><tbody><tr><td><code>Blend NewBlend(bool isSolid, CurveArray topProfile, CurveArray baseProfile, SketchPlane sketchPlane)</code></td><td><a href="https:_apidocs.co_apps_revit_2020_00173a0d-6075-0270-fd7e-080da420d339">融合</a></td></tr><tr><td><code>Revolution NewRevolution(bool isSolid, CurveArrArray profile, SketchPlane sketchPlane, Line axis,double startAngle, double endAngle)</code></td><td><a href="https:_apidocs.co_apps_revit_2020_efde572e-b5fa-14c8-6a1a-a46e36927374">旋转</a></td></tr><tr><td><code>Sweep NewSweep(bool isSolid, ReferenceArray path, SweepProfile profile, int profileLocationCurveIndex,ProfilePlaneLocation profilePlaneLocation)</code></td><td>放样</td></tr><tr><td><code>Sweep NewSweep(bool isSolid, ReferenceArray path,SketchPlane pathPlane,SweepProfile profile, int profileLocationCurveIndex,ProfilePlaneLocation profilePlaneLocation);</code></td><td>放样</td></tr><tr><td><code>SweptBlend NewSwptBlend(bool isSolid, Referrence path, SweepProfile bottonProfile, SweepProfile topProfile)</code></td><td>放样融合</td></tr><tr><td><code>SweptBlend NewSwptBlend(bool isSolid, Curve path, SketchPlane pathPlane,SweepProfile bottonProfile, SweepProfile topProfile)</code></td><td>放样融合</td></tr></tbody></table><blockquote><p>对于具体的用法参考官方API。仅以拉伸举例,以下为参数说明：</p></blockquote><ul><li>isSolid : 是否是实体（True /False）</li><li>profile : 一个平面上的闭合二维轮廓（对于拉伸轮廓所在的平面与工作平面平行即可）</li><li>sketchPlane : 工作平面（通过几何平面转换，拉伸的方向由工作平面的法向量决定）</li><li>end ： 拉伸高度（double值）</li></ul><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> clr
clr<span class="token punctuation">.</span>AddReference<span class="token punctuation">(</span><span class="token string">&#39;ProtoGeometry&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> Autodesk<span class="token punctuation">.</span>DesignScript<span class="token punctuation">.</span>Geometry <span class="token keyword">import</span> <span class="token operator">*</span>
clr<span class="token punctuation">.</span>AddReference<span class="token punctuation">(</span><span class="token string">&quot;RevitNodes&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> Revit
clr<span class="token punctuation">.</span>ImportExtensions<span class="token punctuation">(</span>Revit<span class="token punctuation">.</span>Elements<span class="token punctuation">)</span>
clr<span class="token punctuation">.</span>ImportExtensions<span class="token punctuation">(</span>Revit<span class="token punctuation">.</span>GeometryConversion<span class="token punctuation">)</span>
clr<span class="token punctuation">.</span>AddReference<span class="token punctuation">(</span><span class="token string">&quot;RevitServices&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> RevitServices
<span class="token keyword">from</span> RevitServices<span class="token punctuation">.</span>Persistence <span class="token keyword">import</span> DocumentManager
<span class="token keyword">from</span> RevitServices<span class="token punctuation">.</span>Transactions <span class="token keyword">import</span> TransactionManager
<span class="token keyword">from</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic <span class="token keyword">import</span> <span class="token operator">*</span>
clr<span class="token punctuation">.</span>AddReference<span class="token punctuation">(</span><span class="token string">&quot;RevitAPI&quot;</span><span class="token punctuation">)</span>
clr<span class="token punctuation">.</span>AddReference<span class="token punctuation">(</span><span class="token string">&quot;RevitAPIUI&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> Autodesk
<span class="token keyword">from</span> Autodesk<span class="token punctuation">.</span>Revit<span class="token punctuation">.</span>DB <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> Autodesk<span class="token punctuation">.</span>Revit<span class="token punctuation">.</span>UI <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment">#模板导入的一堆东西省略不写了</span>
doc <span class="token operator">=</span> DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentDBDocument
uidoc<span class="token operator">=</span>DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentUIApplication<span class="token punctuation">.</span>ActiveUIDocument
uiapp <span class="token operator">=</span> DocumentManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>CurrentUIApplication
app <span class="token operator">=</span> uiapp<span class="token punctuation">.</span>Application
<span class="token comment">#需要注意的是轮廓线是个二维数组，即多个闭合轮廓</span>
<span class="token keyword">def</span> <span class="token function">GetCurves</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>
    <span class="token builtin">len</span> <span class="token operator">=</span> <span class="token number">300</span><span class="token operator">/</span><span class="token number">304.8</span>
    p1 <span class="token operator">=</span> XYZ<span class="token punctuation">(</span><span class="token operator">-</span><span class="token builtin">len</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token builtin">len</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    p2 <span class="token operator">=</span> XYZ<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token builtin">len</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    p3 <span class="token operator">=</span> XYZ<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    p4 <span class="token operator">=</span> XYZ<span class="token punctuation">(</span><span class="token operator">-</span><span class="token builtin">len</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    l1 <span class="token operator">=</span> Line<span class="token punctuation">.</span>CreateBound<span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span>
    l2 <span class="token operator">=</span> Line<span class="token punctuation">.</span>CreateBound<span class="token punctuation">(</span>p2<span class="token punctuation">,</span> p3<span class="token punctuation">)</span>
    l3 <span class="token operator">=</span> Line<span class="token punctuation">.</span>CreateBound<span class="token punctuation">(</span>p3<span class="token punctuation">,</span> p4<span class="token punctuation">)</span>
    l4 <span class="token operator">=</span> Line<span class="token punctuation">.</span>CreateBound<span class="token punctuation">(</span>p4<span class="token punctuation">,</span> p1<span class="token punctuation">)</span>

    arr <span class="token operator">=</span> CurveArrArray<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ar <span class="token operator">=</span> CurveArray<span class="token punctuation">(</span><span class="token punctuation">)</span>

    ar<span class="token punctuation">.</span>Append<span class="token punctuation">(</span>l1<span class="token punctuation">)</span>
    ar<span class="token punctuation">.</span>Append<span class="token punctuation">(</span>l2<span class="token punctuation">)</span>
    ar<span class="token punctuation">.</span>Append<span class="token punctuation">(</span>l3<span class="token punctuation">)</span>
    ar<span class="token punctuation">.</span>Append<span class="token punctuation">(</span>l4<span class="token punctuation">)</span>
    arr<span class="token punctuation">.</span>Append<span class="token punctuation">(</span>ar<span class="token punctuation">)</span>
    <span class="token keyword">return</span> arr
arrArray <span class="token operator">=</span> GetCurves<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#生成几何平面，当然也可以使用selection类选择一个面</span>
p1 <span class="token operator">=</span> Plane<span class="token punctuation">.</span>CreateByNormalAndOrigin<span class="token punctuation">(</span>XYZ<span class="token punctuation">.</span>BasisZ<span class="token punctuation">,</span> XYZ<span class="token punctuation">.</span>Zero<span class="token punctuation">)</span>
<span class="token comment">#由几何平面省成本工作平面</span>
sketchPlane <span class="token operator">=</span> SketchPlane<span class="token punctuation">.</span>Create<span class="token punctuation">(</span>doc<span class="token punctuation">,</span> p1<span class="token punctuation">)</span>
<span class="token comment">#开启事务创建拉伸并移动位置</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>EnsureInTransaction<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
rectExtrusion <span class="token operator">=</span> doc<span class="token punctuation">.</span>FamilyCreate<span class="token punctuation">.</span>NewExtrusion<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span>arrArray<span class="token punctuation">,</span>sketchPlane<span class="token punctuation">,</span><span class="token number">4000</span><span class="token operator">/</span><span class="token number">304.8</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">None</span> <span class="token operator">!=</span> rectExtrusion<span class="token punctuation">)</span> <span class="token punctuation">:</span>
     <span class="token comment"># 将生成的拉伸移动到合适的位置</span>
   trans <span class="token operator">=</span> XYZ<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
   ElementTransformUtils<span class="token punctuation">.</span>MoveElement<span class="token punctuation">(</span>doc<span class="token punctuation">,</span> rectExtrusion<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> trans<span class="token punctuation">)</span>
<span class="token keyword">else</span> <span class="token punctuation">:</span>
  TaskDialog<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token string">&quot;Revit&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;生成拉伸失败&quot;</span><span class="token punctuation">)</span>
TransactionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>TransactionTaskDone<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下载后打开族执行就行了 <a href="https://secure2.wostatic.cn/static/ccuP9q4d2StEFNtg5XhAt3/%E6%97%8F%E7%94%9F%E6%88%90%E6%8B%89%E4%BC%B8%E6%B5%8B%E8%AF%95.dyn?auth_key=1660556140-qtpYDYmtFoNa3WbjQE5V1t-0-c610e0b55bcc1850f8fff66a119290aa&amp;download=%E6%97%8F%E7%94%9F%E6%88%90%E6%8B%89%E4%BC%B8%E6%B5%8B%E8%AF%95.dyn" target="_blank" rel="noopener noreferrer">族生成拉伸测试.dyn<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.4258e646.js" defer></script>
  </body>
</html>
